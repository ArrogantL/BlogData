# 2.3Web应用

# web应用概述

## Web与HTTP



- **万维网（英语：World Wide Web）**，亦作“WWW”、“Web”，是一个**由许多互相链接的超文本组成的系统**，通过互联网访问，**发明者Tim Berners-Lee**
  - 网页
  - 网页互相链接
- 网页(Web Page)包含多个对象(objects)
  - 基本HTML文件：包含对其他对象引用的链接
  - 对象：HTML文件、JPEG图片、视频文件、动态脚本等
- **对象的寻址(addressing)**
  - URL(Uniform Resoure Locator)：统一资源定位器 RFC1738
    - 格式： Scheme://host:port/path
    - 例如：http://www.hit.edu.cn/header/article.txt



## HTTP协议概述

**HTTP，原名超文本传输协议，HyperText Transfer Protocol，是web万维网遵守的协议之一。**

- **端口号：80**

- **http网络结构：C/S结构**
  - 客户—Browser：请求、接收、展示Web对象
  - 服务器—Web Server：响应客户的请求，发送对象
- HTTP版本：
  - 1.0： RFC 1945
  - 1.1： RFC 2068



- **http传输层协议：TCP传输协议**

  - 服务器在80端口等待客户的请求
  - 浏览器发起到服务器的TCP连接(创建套接字Socket)
  - 服务器接受来自浏览器的TCP连接
  - 浏览器(HTTP客户端)与Web服务器(HTTP服务器)交换HTTP消息
  - 关闭TCP连接
- **无状态(stateless)**，即无记录

  - 服务器不记录任何有关客户端过去所发请求的信息

    - 有状态的协议**更复杂**:
      -  需维护状态(历史信息)
      -  如果客户或服务器失效，会产生状态的不一致，**解决这种不一致代价高**

# HTTP连接

## HTTP连接的两种类型

- **非持久性连接(NonpersistentHTTP)**
  - **每个TCP连接最多允许传输一个对象**
  - HTTP 1.0版本（早期）使用非持久性连接
- **持久性连接(Persistent HTTP)**
  - **每个TCP连接允许传输多个对象**
  - HTTP 1.1版本默认使用持久性连接

### 非持久性连接

#### 流程

假定用户在浏览器中输入URLwww.someSchool.edu/someDepartment/home.index（包含文本和指向10个jpeg图片的链接）

1. HTTP**客户端**向地址为www.someSchool.edu的**服务器**上的HTTP服务器进程(**端口80**) 发起TCP连接请求。
2. HTTP**服务器**在端口80等待TCP连接请求，**接受连接并通知客户端**。
3. HTTP**客户端将HTTP请求消息(包含URL地址)通过TCP连接的套接字发出**，消息中所含的URL表明客户端需要对象someDepartment/home.index
4. HTTP**服务器**收到请求消息，解析，产生包含所需要对象的**响应消息**，并通过套接字**发给客户端**。HTTP**服务器关闭TCP连接**。
5. HTTP**客户端收到响应消息**，解析html文件，显示html文件，发现有10个指向jpeg对象的超连接。
6. 为每个jpeg对象**重复**步骤**1-5**。而不能接着上次的TCP连接继续交流。

**通俗版：**

服务器我找你！

我听的了什么事？

我想要****。

给你，拜拜。

不再搭理服务器。收到了东西开始处理。

嘿，服务器我还有事情找你！

#### 时延

- **单位：RTT(Round Trip Time)**
  - 从客户端发送一个**很小**的数据包到服务器**并返回**所经历的时间
- **响应时间(Response time)**
  - 发起、建立TCP连接：1个RTT
  - 发送HTTP请求消息到HTTP响应消息的前几个字节到达：1个RTT
  - 响应消息中所含的文件/对象传输时间
  - **Total=2RTT +文件发送时间**

#### 非持久性连接的问题

- **每个对象需要2个RTT**
- 操作系统需要为每个TCP连接**开销资源(overhead)**，同时刻创建大量的连接。
- 浏览器会怎么做？
  - 打开多个并行的TCP连接以获取网页所需对象
  - 给服务器端note造成恶劣的影响，**高密度tcp请求耗尽资源**。

### 持久性HTTP

- 持久性连接
  - **发送响应后，服务器保持TCP连接的打开**
  - 后续的HTTP消息可以通过这个连接发送

- **无流水(pipelining)的持久性连接**
  - **客户端只有收到前一个响应后才发送新的请求**
  - 每个被引用的对象耗时1个RTT
- **带有流水机制的持久性连接**
  - HTTP 1.1的默认选项
  - **客户端只要遇到一个引用对象就尽快发出请求**
  - 理想情况下，收到所有的引用对象只需耗时约1个RTT



# HTTP消息格式

- HTTP协议有两类消息
  - 请求消息(request)
  - 响应消息(response)

## HTTP请求消息

请求消息
 使用ASCII书写：人直接可读

GET /somedir/page.html HTTP/1.1     	请求行： 方法+url+http版本

Host: www.someschool.edu			头部行

User-agent: Mozilla/4.0				头部行

Connection: close					头部行

Accept-language:fr					头部行

									空行表示消息结束

![](/home/arrogantl/text/http请求信息通用格式.png)

### 上传附加输入信息的方法

- POST方法
  - 网页经常需要填写表格(form)
  - 在请求消息的消**息体(entity body)**中上传客户端的输入，entity body在上述的name：value部分之后
- GET方法
  - 使用URL传输，在url后link信息
  - 输入信息通过request行的URL字段上传

### 方法的类型

- HTTP/1.0
  - GET
  - POST
  - HEAD
    - • 请Server不要将所请求的对象放入响应消息，常常用来做测试
- HTTP/1.1
  - GET, POST, HEAD
  - PUT
    - • 将**消息体**中的文件上传到URL字段所指定的路径
  - DELETE
    - • 删除URL字段所指定的文件

## HTTP响应消息

![](/home/arrogantl/text/http响应.png)

date是生成该响应消息的时间，last-modified是请求的服务器资源（比如某个文件）最后的修改时间。

### HTTP响应状态代码

响应消息的第一行

示例
 200 OK
 301 Moved Permanently
 400 Bad Request
 404 Not Found
 505 HTTP Version Not Supported



# Cookie技术

## 为什么需要Cookie？

- **HTTP协议无状态，但是很多应用需要服务器掌握客户端的状态**，如网上购物，如何实现？

## Cookie技术

- Cookie技术
  - 某些网站为了**辨别用户身份、进行session跟踪**而**储存在用户本地终端**上的数据（通常经过加密）。
  - RFC6265
- **Cookie的组件**
  - HTTP响应消息的cookie头部行
  - HTTP请求消息的cookie头部行
  - 保存在客户端主机上的cookie文件，由浏览器管理
  - **Web服务器端的后台数据库**

## Cookie的原理

![](/home/arrogantl/text/cookie原理.png)

**//TODO** ##############################

技术细节没有涉及到，此处要补充，包括session技术，以及cookie验证机制

## Cookie的作用

- Cookie能够用于：
  - 身份认证
  - 购物车
  - 推荐
  - Web e-mail
- 隐私问题

## 思考题

1. Cookie能够怎样被用于收集隐私？
2. 能够收集哪些隐私？
3. 你在上网的时候感觉到自己的隐私
4. 被严重侵犯吗？



# Web缓存/代理服务器技术



## 功能

在不访问服务器的前提下满足客户端的HTTP请求。



## 为什么要发明这种技术？

- 缩短客户请求的响应时间
- 减少机构/组织的流量
- 在大范围内(Internet)实现有效的内容分发



## Web缓存/代理服务器

![](/home/arrogantl/text/web缓存代理服务器技术p1.png)

- 用户设定浏览器通过缓存进行Web访问
- 浏览器向缓存/代理服务器发送所有的HTTP请求
  - • 如果所请求对象在缓存中，缓存返回对象
  - • 否则，缓存服务器向原始服务器发送HTTP请求，获取对象，然后返回给客户端并存该对象

- 缓存既充当客户端，也充当服务器
- 一般由ISP(Internet服务提供商)架设



## Web缓存示例

![](/home/arrogantl/text/web缓存代理服务器技术实例.png)

- 假定：
  - 对象的平均大小=100,000比特
  - 机构网络中的浏览器平均每秒有15个到原始服务器的请求
  - 从机构路由器到原始服务器的往返延迟=2秒
- 网络性能分析：
  - 局域网(LAN)的利用率=1.5M/10M=15%
  - 接入互联网的链路的利用率=100%
  - 总的延迟=互联网上的延迟+访问延迟+局域网延迟=2秒+几分钟+几微秒



- 解决方案1：
  - **提升互联网接入带宽**=10Mbps
- 网络性能分析：
  - 局域网(LAN)的利用率=15%
  - 接入互联网的链路的利用率=15%
  - 总的延迟=互联网上的延迟+访问延迟+局域网延迟=2秒+几微秒+几微秒
- 问题：
  - **成本太高**



- 解决方案2：
  - 安装Web缓存
  - **假定缓存命中率是0.4**
- 网络性能分析：
  - 40%的请求立刻得到满足
  - 60%的请求通过原始服务器满足
  - 接入互联网的链路的利用率下降到60%，**从而其延迟可以忽略不计**，例如10微秒
  - 总的平均延迟=互联网上的延迟+访问延迟+局域网延迟=0.6×2.01秒+0.4×min微秒<1.4秒
- 问题：
  - 缓存和远端服务器资源是否一致？或者版本是否满足用户要求？

## 条件性GET方法

解决了缓存和远端服务器资源是否一致？或者版本是否满足用户要求？的问题。

- 目标：
  - 代理服务器向远端服务其的get请求进行设计，告知远端服务器该代理所持资源版本，远端服务器检查后，若是最新版则不发送请求的对象。
- 缓存：
  - 在HTTP请求消息中声明所持有版本的日期
  - If-modified-since: （告诉远端，如果在**日期之后远端资源更改，则发送所请求对象）
- 服务器：
  - 如果缓存的版本是最新的，则响应消息中不包含对象
  - HTTP/1.0 304 Not Modified

## 课后作业

检索文献，分析、总结Web技术近
年来有哪些新进展？其关键思想和
技术是什么？