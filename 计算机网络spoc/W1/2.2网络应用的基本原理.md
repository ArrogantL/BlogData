# 2.2网络应用的基本原理

# 网络应用进程通信

## 进程间通信

- 进程
  - 主机上运行的程序
  - **客户机进程**: 发起通信的进程
  - **服务器进程**: 等待通信请求的进程

- 同一主机上运行的进程之间如何通信？
  - 进程间通信机制
  - 操作系统提供

- 不同主机上运行的进程间如何通信？
  - 消息交换

**采用P2P架构的应用是否存在客户机进程/服务器进程之分？**

也是有的，只是角色转换非常自由。

## 套接字: Socket

- Socket（套接字、插座）并不是一种协议，而是一种抽象API，将传输层TCP/UDP协议封装，作为一种门面模式提供应用层抽象的连接服务。Socket实质上提供了进程通信的端点。
- Socket=（所用协议，本地IP地址，本地进程端口号），唯一，由本地操作系统分配
- Socket面向C/S设计。
- C/S连接建立过程
  - 服务器监听：是**服务器端套接字**并不定位具体的**客户端套接字**，而是处于等待连接的状态，实时监控网络状态。
  - 客户端请求：是指由**客户端的套接字**提出连接请求，要连接的目标是**服务器端的套接字**。为此，客户端的套接字必须首先描述它要连接的服务器的套接字，指出服务器端套接字的地址和端口号，然后就向服务器端套接字提出连接请求。
  - 连接确认：是指当服务器端套接字监听到或者说接收到客户端套接字的连接请求，它就响应客户端套接字的请求，建立一个新的线程，把服务器端套接字的描述发给客户端，一旦客户端确认了此描述，连接就建立好了**。而服务器端套接字继续处于监听状态，继续接收其他客户端套接字的连接请求。**

## 寻址

**不同主机上的进程间通信，那么每个进程必须拥有标识符**

- 如何寻址主机？——IP地址
  -  Q: 主机有了IP地址后，是否足以定位进程？
  -  **A: 否。IP地址只能定位主机，同一主机上可能同时有多个进程需要通信。**
- **端口号/Port number**
  -  为主机上**每个需要通信的进程**分配一个端口号
  -  **HTTP Server: 80**
  -  **Mail Server：25**
- 进程的标识符
  -  **IP地址+端口号**

## 应用层协议

网络应用需遵循应用层协议,但是不仅仅有应用层协议

- 公开协议（由RFC定义）
  - DNS
  - FTP
  - SMTP
  - HTTP
  - Telnet（远程登陆服务）
- 私有协议
  - 多数P2P文件共享应用
- 应用层数据传输依赖传输层协议：
  - tcp
  - udp

### 应用层协议的内容

信息类型、信息语法、信息语义、信息规则

- 消息的类型(**type**)
  -  请求消息
  -  响应消息
- 消息的语法(**syntax**)/格式
  -  消息中有哪些字段(**field**)？
  -  每个字段如何描述
- 字段的语义(**semantics**)
  -  字段中信息的含义
- 规则(**rules**)
  -  进程**何时**发送/响应消息
  -  进程**如何**发送/响应消息





# 网络应用的需求与传输层服务

## 网络应用对传输服务的需求

- **数据丢失**(data loss)/可靠性(reliability)
  -  某些网络应用能够容忍一定的数据丢失：网络电话
  -  某些网络应用要求100%可靠的数据传输：文件传输，telnet
- 时间(timing)/**延迟**(delay)
  -  有些应用只有在延迟足够低时才“有效”
  -  网络电话/网络游戏
- **带宽**(bandwidth)
  -  某些应用只有在带宽达到最低要求时才“有效”：网络视频
  -  某些应用能够适应任何带宽——弹性应用：email
- **延迟和带宽的不同**：
  - 带宽是bps，是单位时间交换数据量，延迟是数据发送到接受所用时间，和带宽不是一个概念。
  - 带宽小于发送量会导致延迟上升。带宽小于发送量仍然有延迟，此时延迟是数据从源发送到目的所需时间

## Internet提供的传输服务

- TCP服务，传输控制协议（英语：Transmission Control Protocol，縮寫為**TCP**）
  - 面向连接: 客户机/服务器进程间需要建立连接。
  - 可**靠的数据传输：准确、完整、有序。注意没有带宽和延迟！**
    - 准确：保证数据包没有失真
      - 校验码
    - 完整：降低丢包率
      - 接受反馈：接受发接受到数据必须告知发送方，否则发送方会重发，保证分组完整
      - 流量控制: 发送方不会发送速度过快，超过接收方的处理能力
      - 拥塞控制: 当网络负载过重时能够限制发送方的发送速度
    - 有序：保证分组重组顺序正确
      - 为分组标记序号。接收方使用序号，不重收，不乱序。
  - **不提供时间/延迟保障**
  - **不提供最小带宽保障**
  - 握手三次
    - A申请建立
    - B回复批准
    - A回复收到批准
  - 挥手四次
    - A申请结束
    - B回复收到申请，并发送尚未传输完成的数据
    - B批准申请
    - A回复收到批准
- UDP服务，用户数据报协议（英语：User Datagram Protocol，縮寫為**UDP**），又稱使用者資料包協定
  - 无连接，单纯的发送出去
  - 不可靠的数据传输（单纯的发送出去，什么保障都没有）
  - 不提供
    - 可靠性保障
    - 流量控制
    - 拥塞控制
    - 延迟保障
    - 带宽保障
  - 正是由与udp如此低级，他只能支持最基本的功能，但是它提供了掌控数据传输的自由性。可以让应用自由设置发挥
- 应用场景：
  - 稳定>速度：tcp
    - HTTP、FTP、POP、SMTP
  - 速度>稳定：udp
    - 视频、语音通话



## 课后练习

- 盘点你计算机上的所有网络应用，制作一个清单，包括网络应用的名字、功能、协议等。
- 基于上述清单，制作表格，分析这些网络应用对传输服务的需求。分析这些网络应用所使用的传输服务是TCP还是UDP。